<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 
        PlantSaga Shared Plant Preview Page (Split-View Redesign v2)
        - Layout: Desktop two-column split-view (Imagery Left, Content Right)
        - Theme: Premium Sage Green (#E8EFE8)
        - Components: Product gallery, Care grid, Pulsing CTA, App store badges
        - Mobile: Responsive stacking layout
    -->
    <title>PlantSaga | Shared Plant</title>

    <!-- Dynamic OG Tags -->
    <meta property="og:title" id="og-title" content="Check out this plant on PlantSaga">
    <meta property="og:description" id="og-desc" content="Every plant has a story. Open PlantSaga to see more.">
    <meta property="og:image" id="og-image" content="https://plantsaga.com/logo.png">
    <meta property="og:type" content="website">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@600;700;800&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <style>
        :root {
            --primary: #22c55e;
            --primary-dark: #16a34a;
            --secondary: #0a2e1f;
            --sage-bg: #E8EFE8;
            --text-main: #1a202c;
            --text-muted: #64748b;
            --bg-light: #f3f4f6;
            --white: #ffffff;
            --shadow-soft: 0 10px 25px rgba(0, 0, 0, 0.03);
            --shadow-bold: 0 20px 40px rgba(0, 0, 0, 0.08);
            --inner-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.02);
            --transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--sage-bg);
            color: var(--text-main);
            line-height: 1.6;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Responsive Container */
        .app-container {
            width: 100%;
            max-width: 1100px;
            background: var(--white);
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 80px rgba(10, 46, 31, 0.05);
            display: flex;
            flex-direction: column;
        }

        /* Header - Top Left Alignment */
        header {
            padding: 24px 40px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            background: var(--white);
            z-index: 100;
        }

        .header-link {
            display: flex;
            align-items: center;
            text-decoration: none;
            transition: var(--transition);
        }

        .header-link:active {
            transform: scale(0.98);
        }

        .nav-logo {
            height: 32px;
            margin-right: 12px;
        }

        .brand-name {
            font-family: 'Outfit', sans-serif;
            font-size: 22px;
            font-weight: 800;
            color: var(--secondary);
            letter-spacing: -0.5px;
        }

        /* Split View Content */
        .page-content {
            display: flex;
            gap: 48px;
            padding: 0 40px 60px 40px;
            flex-grow: 1;
        }

        .col-left {
            flex: 1.2;
            min-width: 0;
        }

        .col-right {
            flex: 0.8;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }

        /* Loader */
        #loader {
            position: absolute;
            inset: 0;
            background: var(--white);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .plant-loader {
            width: 50px;
            height: 50px;
            border: 3px solid #f3f4f6;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }

        /* Product Gallery */
        .gallery-wrap {
            background: #fff;
            margin-bottom: 32px;
        }

        .hero-image-container {
            width: 100%;
            height: 450px;
            background: #f9fafb;
            border-radius: 28px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: var(--inner-shadow);
        }

        .hero-image {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
            transition: opacity 0.3s ease;
        }

        .hero-image.fade-out {
            opacity: 0;
        }

        .thumbnail-row {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            overflow-x: auto;
            padding: 4px;
            scrollbar-width: none;
        }

        .thumbnail-row::-webkit-scrollbar {
            display: none;
        }

        .thumbnail {
            width: 72px;
            height: 72px;
            flex-shrink: 0;
            border-radius: 16px;
            border: 2px solid #f1f5f9;
            cursor: pointer;
            overflow: hidden;
            transition: var(--transition);
            background: #fff;
        }

        .thumbnail.active {
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15);
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Plant Header (Right Col) */
        .plant-header {
            margin-bottom: 24px;
        }

        .plant-title {
            font-family: 'Outfit', sans-serif;
            font-size: 38px;
            font-weight: 800;
            color: var(--text-main);
            line-height: 1.1;
            margin-bottom: 8px;
        }

        .scientific-name {
            font-size: 18px;
            color: var(--text-muted);
            font-style: italic;
        }

        .badge-wrap {
            margin-bottom: 16px;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(34, 197, 94, 0.06);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            color: var(--primary-dark);
            padding: 8px 18px;
            border-radius: 100px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid rgba(34, 197, 94, 0.1);
        }

        /* Care Matrix Grid (Left Col) */
        .care-card {
            background: #fff;
            border-radius: 28px;
            padding: 28px;
            border: 1px solid rgba(0, 0, 0, 0.03);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.01);
        }

        .care-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .care-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 12px;
        }

        .icon-box {
            width: 48px;
            height: 48px;
            background: #f8fafc;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .water ion-icon {
            color: #3b82f6;
        }

        .light ion-icon {
            color: #f59e0b;
        }

        .temp ion-icon {
            color: #ef4444;
        }

        .humid ion-icon {
            color: #06b6d4;
        }

        .care-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .care-label {
            font-size: 10px;
            font-weight: 800;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .care-value {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-main);
        }

        /* About & Onboarding (Right Col) */
        .about-section {
            margin-bottom: 32px;
        }

        .about-section h3 {
            font-family: 'Outfit', sans-serif;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--secondary);
        }

        .description {
            font-size: 16px;
            color: #4b5563;
            line-height: 1.7;
        }

        .onboarding-box {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05) 0%, rgba(34, 197, 94, 0.02) 100%);
            border-radius: 24px;
            padding: 24px;
            border: 1px dashed rgba(34, 197, 94, 0.3);
            margin-bottom: 24px;
        }

        .onboarding-box p {
            font-size: 15px;
            color: var(--secondary);
            font-weight: 500;
            line-height: 1.6;
        }

        .action-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .btn-main {
            background: var(--primary);
            color: #fff;
            width: 100%;
            height: 64px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 18px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            cursor: pointer;
            box-shadow: 0 15px 30px rgba(34, 197, 94, 0.25);
            transition: var(--transition);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
            }

            70% {
                box-shadow: 0 0 0 15px rgba(34, 197, 94, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
            }
        }

        .btn-main:active {
            transform: scale(0.96);
        }

        .store-badges {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .store-badge img {
            height: 44px;
            width: auto;
            border-radius: 8px;
            transition: var(--transition);
        }

        .store-badge:active img {
            transform: scale(0.95);
        }

        /* Mobile View (Stacking) */
        @media (max-width: 900px) {
            header {
                padding: 20px 24px;
            }

            .page-content {
                flex-direction: column;
                padding: 0 24px 60px 24px;
                gap: 0;
            }

            .hero-image-container {
                height: 350px;
            }

            .care-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .col-right {
                margin-top: 40px;
            }

            .plant-title {
                font-size: 32px;
            }
        }

        /* Error state */
        .error-msg {
            padding: 60px 40px;
            text-align: center;
        }
    </style>
</head>

<body>

    <div class="app-container">
        <header>
            <a href="../" class="header-link">
                <img src="../logo.png" alt="PlantSaga" class="nav-logo">
                <span class="brand-name">PlantSaga</span>
            </a>
        </header>

        <div id="loader">
            <div class="plant-loader"></div>
            <p
                style="margin-top: 20px; color: var(--text-muted); font-size: 13px; font-weight: 700; letter-spacing: 1px;">
                SYNCING BOTANICAL DATA...</p>
        </div>

        <div id="main-content" style="display: none;">
            <main class="page-content">
                <!-- Left Column: Imagery & Care -->
                <div class="col-left">
                    <div class="gallery-wrap">
                        <div class="hero-image-container">
                            <img id="hero-image" src="" class="hero-image" alt="Plant Preview"
                                onerror="this.src='../logo.png'">
                        </div>
                        <div class="thumbnail-row" id="thumbnail-row">
                            <!-- Thumbnails Injected -->
                        </div>
                    </div>

                    <div class="care-card">
                        <div class="care-grid">
                            <div class="care-item water">
                                <div class="icon-box"><ion-icon name="water"></ion-icon></div>
                                <div class="care-info">
                                    <span class="care-label">Watering</span>
                                    <span class="care-value" id="water">-</span>
                                </div>
                            </div>
                            <div class="care-item light">
                                <div class="icon-box"><ion-icon name="sunny"></ion-icon></div>
                                <div class="care-info">
                                    <span class="care-label">Light</span>
                                    <span class="care-value" id="light">-</span>
                                </div>
                            </div>
                            <div class="care-item temp">
                                <div class="icon-box"><ion-icon name="thermometer"></ion-icon></div>
                                <div class="care-info">
                                    <span class="care-label">Temp</span>
                                    <span class="care-value" id="temp">-</span>
                                </div>
                            </div>
                            <div class="care-item humid">
                                <div class="icon-box"><ion-icon name="cloud"></ion-icon></div>
                                <div class="care-info">
                                    <span class="care-label">Humidity</span>
                                    <span class="care-value" id="humidity">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Details & CTA -->
                <div class="col-right">
                    <div class="badge-wrap">
                        <div class="badge">
                            <ion-icon name="leaf"></ion-icon>
                            Shared via PlantSaga
                        </div>
                    </div>

                    <div class="plant-header">
                        <h1 class="plant-title" id="plant-name">-</h1>
                        <p class="scientific-name" id="sci-name">-</p>
                    </div>

                    <div class="about-section">
                        <h3>About Plant</h3>
                        <p class="description" id="description">-</p>
                    </div>

                    <div class="onboarding-box">
                        <p>
                            Your friend's garden is growing on PlantSaga! ðŸŒ¿ <br><br>
                            Join our community to save this plant, get expert care reminders, and start your own
                            flourishing home garden. Download, login, and click the original link to bring this specimen
                            into your digital collection.
                        </p>
                    </div>

                    <div class="action-area">
                        <button class="btn-main" onclick="launchApp()">
                            <ion-icon name="download-outline" style="font-size: 20px;"></ion-icon>
                            Open in App to Save
                        </button>

                        <div class="store-badges">
                            <a href="https://apps.apple.com/us/app/plantsaga/id6757720295" class="store-badge"
                                target="_blank">
                                <img src="https://tools.applemediaservices.com/api/badges/download-on-the-app-store/black/en-us?size=250x83&amp;releaseDate=1314316800&h=64923838ae1c46294d306443c683b772"
                                    alt="Download on the App Store">
                            </a>
                            <a href="https://play.google.com/store/apps/details?id=plant.care.app" class="store-badge"
                                target="_blank">
                                <img src="https://play.google.com/intl/en_us/badges/static/images/badges/en_badge_web_generic.png"
                                    alt="Get it on Google Play" style="height: 60px; margin-top: -8px;">
                            </a>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Firebase -->
    <script type="importmap">
        {
          "imports": {
            "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"
          }
        }
    </script>

    <script type="module">
        import { initializeApp } from "firebase/app";
        import { getFirestore, doc, getDoc } from "firebase/firestore";

        const config = {
            apiKey: "AIzaSyADNiXew2VJF-Ri9Ovg8IaIVr8_b0bDKyE",
            authDomain: "plantapp-51c9a.firebaseapp.com",
            projectId: "plantapp-51c9a",
            storageBucket: "plantapp-51c9a.firebasestorage.app",
            messagingSenderId: "374286040864"
        };

        const fb = initializeApp(config);
        const db = getFirestore(fb);

        const params = new URLSearchParams(window.location.search);
        const pid = params.get('pid') || params.get('id');
        const uid = params.get('uid');

        async function init() {
            if (!pid) return showError("No specimen ID provided in the link.");

            try {
                let data = null;
                const gRef = doc(db, "globalPlants", pid);
                const gSnap = await getDoc(gRef);

                if (gSnap.exists()) {
                    data = gSnap.data();
                } else if (uid) {
                    const uRef = doc(db, "users", uid, "plants", pid);
                    const uSnap = await getDoc(uRef);
                    if (uSnap.exists()) {
                        const raw = uSnap.data();
                        if (raw.globalPlantId) {
                            const ref = await getDoc(doc(db, "globalPlants", raw.globalPlantId));
                            data = { ...ref.data(), ...raw };
                        } else {
                            data = raw;
                        }
                    }
                }

                if (data) populate(data);
                else showError("Specimen not found. It may be part of a private collection.");
            } catch (e) {
                console.error("Firebase Error:", e);
                showError("Unable to load plant data. Please try again later.");
            }
        }

        function populate(d) {
            document.getElementById('plant-name').innerText = d.nickname || d._cachedPlantName || d.name || "Unnamed Specimen";
            document.getElementById('sci-name').innerText = d.scientificName || d._cachedScientificName || "Botanical details in app";

            const desc = d.description || d._cachedDescription || (d.notes && d.notes.length > 0 ? d.notes[0] : null);
            document.getElementById('description').innerText = desc || "A beautiful specimen being nurtured in a private collection.";

            const c = d.careInstructions || {};
            document.getElementById('water').innerText = c.watering?.frequency || "Weekly";
            document.getElementById('light').innerText = c.sunlight?.requirement || "Bright";
            document.getElementById('temp').innerText = c.temperature ? `${c.temperature.min || 18}-${c.temperature.max || 24}Â°C` : "18-24Â°C";
            document.getElementById('humidity').innerText = c.humidity?.requirement || "Medium";

            const photos = d.photos ? d.photos.map(p => p.url) : (d.images || []);
            if (photos.length === 0) photos.push('../logo.png');

            const hero = document.getElementById('hero-image');
            const thumbRow = document.getElementById('thumbnail-row');

            hero.src = photos[0];

            if (photos.length > 1) {
                thumbRow.innerHTML = photos.map((url, i) => `
                    <div class="thumbnail ${i === 0 ? 'active' : ''}" onclick="switchHero('${url}', this)">
                        <img src="${url}" loading="lazy">
                    </div>
                `).join('');
            } else {
                thumbRow.style.display = 'none';
            }

            document.title = `${d.nickname || d.name} | PlantSaga`;
            document.getElementById('og-title').content = `${d.nickname || d.name} on PlantSaga`;
            document.getElementById('og-image').content = photos[0];

            hideLoader();
        }

        window.switchHero = (url, el) => {
            const hero = document.getElementById('hero-image');
            if (hero.src === url) return;
            hero.classList.add('fade-out');
            setTimeout(() => {
                hero.src = url;
                hero.classList.remove('fade-out');
                document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                el.classList.add('active');
            }, 300);
        };

        function showError(m) {
            document.getElementById('loader').innerHTML = `
                <div class="error-msg">
                    <ion-icon name="close-circle-outline" style="font-size: 64px; color: #e2e8f0;"></ion-icon>
                    <h2 style="margin-top: 24px; font-family: 'Outfit';">Specimen Missing</h2>
                    <p style="color: #94a3b8; margin-top: 12px; font-size: 15px;">${m}</p>
                    <a href="../" style="display:inline-block; margin-top:32px; color:var(--primary); font-weight:700; text-decoration:none; border: 2px solid var(--primary); padding: 12px 24px; border-radius: 14px;">Return Home</a>
                </div>
            `;
        }

        function hideLoader() {
            const l = document.getElementById('loader');
            l.style.transition = 'opacity 0.6s ease';
            l.style.opacity = '0';
            setTimeout(() => {
                l.style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
            }, 600);
        }

        window.launchApp = () => {
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            const deep = `plantsaga://share/${pid}`;
            const store = isIOS ? "https://apps.apple.com/us/app/plantsaga/id6757720295" : "https://play.google.com/store/apps/details?id=plant.care.app";
            window.location.href = deep;
            setTimeout(() => { if (!document.hidden) window.location.href = store; }, 2500);
        };

        init();
    </script>
</body>

</html>